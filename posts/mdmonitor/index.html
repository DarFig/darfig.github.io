<!DOCTYPE html>
<html class=" negro" lang="es-ES">
    <meta charset="utf-8">
    <meta name="viewport" content="witdth=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code|Press+Start+2P|Source+Code+Pro&display=swap" rel="stylesheet"> 
   
    <link rel="stylesheet" href="/css/bulma.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/navbar.css" />

<title>mdmonitor - Blg0</title>

<body class="grisOscuro"><nav class="lateral-navbar">

  <ul class="lateral-navbar-nav bordeVerde">
    <li class="start2p lateral-nav-item ">
      <a href="/" class="lateral-nav-link textoVerde">
        <img src="/img/disk.png" class="nav-img iconsP panel-icon" alt="">
        <span class="textoVerde lateral-nav-text">Home</span>  
      </a>
    </li>
    <li class="start2p lateral-nav-item ">
      <a href="/posts/" class="lateral-nav-link textoVerde">
        <img src="/img/paper.png" class="nav-img iconsP panel-icon" alt="">
        <span class="textoVerde lateral-nav-text">Posts</span>  
      </a>
    </li>
    <li class="start2p lateral-nav-item ">
      <a href="/projects/" class="lateral-nav-link textoVerde">
        <img src="/img/flami.png" class="nav-img iconsP panel-icon" alt="">
        <span class="textoVerde lateral-nav-text">Projects</span>  
      </a>
    </li>
    <li class="start2p lateral-nav-item ">
      <a href="/about/" class="lateral-nav-link textoVerde">
        <img src="/img/gosht.png" class="nav-img iconsP panel-icon" alt="">
        <span class="textoVerde lateral-nav-text">About</span>  
      </a>
    </li>
    
  </ul>

</nav>
<nav class="container-fluid negro ">
    
    <div class=" ">
        
        <div class=" ">
            <a class="" href="/">   
                <figure class="centrar image is-128x128">
                    <img class="bordeVerde is-rounded" src="https://avatars2.githubusercontent.com/u/13577926?s=460&amp;v=4" width="50" height="50"alt="Brand">
                 
                </figure>
            </a>
           
        </div>
        <div class=" ">
          <a href=""  class="">  
            <h1 class="textoCentrado textoVerde start2p title is-1 "> Blg0</h1>
          </a>
        </div>
      
    
      </div>

</nav>



    
    <div id="content">
            
        <h1></h1>

<div  role="main" class="sourceCode section" >
    <div class="columns">
        <div class="column is-2">
            
        </div>

        <div class="column is-8">
            <div class="negro bordeVerde">
                <div class="column textoCentrado">
                    <h3 class="textoVerde start2p title is-4">Post</h3>
                </div>
            </div>
            <div class="column"></div>
            <div class="column card grisClaro bordeVerde">
                <div class="start2p card-header">
                    <div class="card-header-title is-centered">
                    mdmonitor
                    </div>
                </div>
                <div class="card-content"></div>
                <div class="start2p card-header">
                    <div class="content" style="font-size: 70%;
                        color: #92d192;">
                        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#mdmonitor">mdmonitor</a>
              <ul>
                <li><a href="#mdadmconf">mdadm.conf</a></li>
              </ul>
            </li>
            <li><a href="#arrancando-el-demonio">Arrancando el demonio</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
                    </div>
                </div>
                <div class="card-content">
                    
                    <div class="">
                        
                        <div class="content formatoTexto">
                        
                        <p>Un error común entre novatos al utilizar <strong>md</strong> para sus raids software es configurar incorrectamente o no configurar el <em>daemon</em> de <em>md</em>, también llamado <em>mdmonitor</em>.</p>
<h3 id="mdmonitor">mdmonitor</h3>
<p>El modo &ndash;monitor de <em>mdadm</em> corre de manera continua con el objetivo de detectar problemas en nuestro RAID y alertarnos. Su comportamiento será según tengamos configurado nuestro <strong>mdadm.conf</strong>. Este fichero no es requerido para el funcionamiento de <em>mdadm</em>. Pero si lo es si queremos guardar la configuración de nuestro RAID, y que se auto-monte en el arranque. Veamos la configuración básica que necesitamos.</p>
<h4 id="mdadmconf">mdadm.conf</h4>
<p>Este fichero se puede almacenar en <em>/etc/mdadm/mdadm.conf</em> o en <em>/etc/mdadm.conf</em>. No se genera de manera automática, así que tendremos que añadir ahí nuestras configuraciones cuando generemos nuestro raid.</p>
<p>Para guardar la configuración de nuestros raids basta con añadir a nuestro fichero la salida del comando:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mdadm --detail --scan 
</span></span></code></pre></div><p><strong>Con esto no basta</strong></p>
<p>Hasta ahora hemos dicho que hay que monitorizar, pero no como nos alertan.</p>
<p>La configuración válida más sencilla requiere configurar las alertas por correo. Basta con añadir al inicio del <em>mdadm.conf</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>MAILADDR ejemplo@ejemplo.com
</span></span></code></pre></div><p>También es válida una cuenta local, por ejemplo podemos enviar los avisos al root y se generará un fichero en su cuenta con las alertas.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>MAILADDR root
</span></span></code></pre></div><p>Entonces tendríamos un fichero básico de configuración que podría verse así por ejemplo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># instruct the monitoring daemon where to send mail alerts </span>
</span></span><span style="display:flex;"><span>MAILADDR root
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># definitions of existing MD arrays</span>
</span></span><span style="display:flex;"><span>ARRAY /dev/md/raid1 metadata1.2 name<span style="color:#f92672">=</span>host1:raid1 UUID<span style="color:#f92672">=</span>b7de2fc:60b303ac:3c176049:dc5b6c8b
</span></span></code></pre></div><h3 id="arrancando-el-demonio">Arrancando el demonio</h3>
<p>Ahora sí podríamos habilitar nuestro <em>mdmonitor</em> y activarlo para que empiece a trabajar.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># por ejemplo en centos</span>
</span></span><span style="display:flex;"><span>systemctl enable mdmonitor.service
</span></span><span style="display:flex;"><span>systemctl start mdmonitor.service
</span></span></code></pre></div><p><em>Como es obvio hay más opciones disponibles, podemos consultarlas en la documentación. Algunas muy interesantes. Pero esto es lo mínimo necesario para que nuestro mdmonitor funcione.</em></p>
<p>Saludos
<a href="https://github.com/DarFig">DarFig</a></p>
                        
                        </div>
                        <br>
                    </div>
                    
                </div>
                <div class=" card-footer is-right">
                    <div class="card-header-title is-centered">
                        July 22 - 2020
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

        </div>
        
    <div class="alpie"></div>   
    </body><footer  class="negro pie">
    <div class="container">
        <div>
            <br>
            <p align="center"  class="textoVerde LettCab text-muted">
                © by darfig <a href="https://github.com/DarFig">https://github.com/DarFig</a>
            </p>
        </div>
    </div>

</footer>



</html>
