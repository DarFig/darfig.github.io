<!DOCTYPE html>
<html class=" negro" lang="es-ES">
    <meta charset="utf-8">
    <meta name="viewport" content="witdth=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code|Press+Start+2P|Source+Code+Pro&display=swap" rel="stylesheet"> 
   
    <link rel="stylesheet" href="/css/bulma.css" />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/navbar.css" />

<title>Deepops, slurm y otras cosas de herramientas de despliegue comunitarias - Blg0</title>
<meta name="generator" content="Hugo 0.82.0" />
<body class="grisOscuro"><nav class="lateral-navbar">

  <ul class="lateral-navbar-nav bordeVerde">
    <li class="start2p lateral-nav-item ">
      <a href="/" class="lateral-nav-link textoVerde">
        <img src="/img/disk.png" class="nav-img iconsP panel-icon" alt="">
        <span class="textoVerde lateral-nav-text">Home</span>  
      </a>
    </li>
    <li class="start2p lateral-nav-item ">
      <a href="/posts/" class="lateral-nav-link textoVerde">
        <img src="/img/paper.png" class="nav-img iconsP panel-icon" alt="">
        <span class="textoVerde lateral-nav-text">Posts</span>  
      </a>
    </li>
    <li class="start2p lateral-nav-item ">
      <a href="/projects/" class="lateral-nav-link textoVerde">
        <img src="/img/flami.png" class="nav-img iconsP panel-icon" alt="">
        <span class="textoVerde lateral-nav-text">Projects</span>  
      </a>
    </li>
    <li class="start2p lateral-nav-item ">
      <a href="/about/" class="lateral-nav-link textoVerde">
        <img src="/img/gosht.png" class="nav-img iconsP panel-icon" alt="">
        <span class="textoVerde lateral-nav-text">About</span>  
      </a>
    </li>
    
  </ul>

</nav>
<nav class="container-fluid negro ">
    
    <div class=" ">
        
        <div class=" ">
            <a class="" href="/">   
                <figure class="centrar image is-128x128">
                    <img class="bordeVerde is-rounded" src="https://avatars2.githubusercontent.com/u/13577926?s=460&amp;v=4" width="50" height="50"alt="Brand">
                 
                </figure>
            </a>
           
        </div>
        <div class=" ">
          <a href=""  class="">  
            <h1 class="textoCentrado textoVerde start2p title is-1 "> Blg0</h1>
          </a>
        </div>
      
    
      </div>

</nav>



    
    <div id="content">
            
        <h1></h1>

<div  role="main" class="sourceCode section" >
    <div class="columns">
        <div class="column is-2">
            
        </div>

        <div class="column is-8">
            <div class="negro bordeVerde">
                <div class="column textoCentrado">
                    <h3 class="textoVerde start2p title is-4">Post</h3>
                </div>
            </div>
            <div class="column"></div>
            <div class="column card grisClaro bordeVerde">
                <div class="start2p card-header">
                    <div class="card-header-title is-centered">
                    Deepops, slurm y otras cosas de herramientas de despliegue comunitarias
                    </div>
                </div>
                <div class="card-content"></div>
                <div class="start2p card-header">
                    <div class="content" style="font-size: 70%;
                        color: #92d192;">
                        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#el-contexto">El contexto</a></li>
        <li><a href="#las-sorpresas">Las sorpresas</a></li>
        <li><a href="#errores">Errores</a>
          <ul>
            <li><a href="#al-ataque">Al ataque</a></li>
            <li><a href="#ya-est√°-todo-instalado-pero-no-en-funcionamiento">Ya est√° todo instalado, pero no en funcionamiento</a></li>
          </ul>
        </li>
        <li><a href="#en-resumen">En resumen</a></li>
      </ul>
    </li>
  </ul>
</nav>
                    </div>
                </div>
                <div class="card-content">
                    
                    <div class="">
                        
                        <div class="content formatoTexto">
                        
                        <p>Voy a contar el resumen de lo que he pasado los √∫ltimos d√≠as para desplegar <a href="https://slurm.schedmd.com/documentation.html">slurm</a>, utilizando la herramienta <a href="https://github.com/NVIDIA/deepops">deepops</a>. Pero lo voy a utilizar s√≥lo como un ejemplo para hablar de los problemas que puedes encontrarte con otras herramientas similares.</p>
<h2 id="el-contexto">El contexto</h2>
<p>En resumen <strong>slurm</strong> es una herramienta para gestionar cargas de trabajo, basado en colas, por ejemplo en un cl√∫ster  de s√∫per computaci√≥n.  Que a su vez se ha incluido en la herramienta <strong>deepops</strong>, una serie de playbooks de <a href="https://www.ansible.com/">ansible</a> y scripts pensados para ayudar en la configuraci√≥n y despliegue de software en los servidores, dgx de nvidia, y similares. Esto es una gran idea, tienes un servidor y una serie de herramientas que te ayudan a desplegar software siguiendo lo que podr√≠amos llamar ‚Äúbuenas pr√°cticas‚Äù.</p>
<p>As√≠ que me dispuse a utilizar <strong>deepops</strong> 20.11 para desplegar <strong>slurm</strong>, siguiendo las recomendaciones de la <a href="https://github.com/NVIDIA/deepops/tree/master/docs/slurm-cluster">documentaci√≥n</a> .</p>
<h2 id="las-sorpresas">Las sorpresas</h2>
<p>Las primeras sorpresas que me encontr√© fueron enlaces rotos, y poca documentaci√≥n sobre las variables que deb√≠a configurar si decid√≠a modificar un poco el ‚Äúgui√≥n‚Äù que viene pre-establecido.  Claro que si me leo los <em>playbooks</em> me voy a enterar de lo que hace cada tarea, pero se supone que el objetivo no es que yo haga ingenier√≠a inversa, sino que  me lea una documentaci√≥n de como utilizar la herramienta.</p>
<p>Creo que aqu√≠ mi confusi√≥n es por venir enlazado desde la documentaci√≥n de nvidia y ver que el repositorio estaba bajo el perfil de nvidia, cuando la herramienta claramente la mantiene la comunidad. A la que sin duda hay que estarle muy agradecidos porque hace un gran trabajo. Este tipo de situaciones se hacen cada vez m√°s comunes. Es normal que si llegas a un repositorio, mantenido por la comunidad, en el cual hay mucho movimiento y se lanzan mejoras cada poco tiempo, la documentaci√≥n no est√© al d√≠a. Nos toca poner un poco de nuestra parte y respetar el trabajo que hacen, muchas veces de manera voluntaria, esas personas. Incluso si lo vemos claro podemos poner de nuestra parte actualizar la versi√≥n y enviar un <em>pull request</em>.</p>
<p>Una vez entendido esto, voy  a comentar errores comunes que podemos encontrarnos con este tipo de herramientas y que pueden darnos alg√∫n quebradero de cabeza.</p>
<h2 id="errores">Errores</h2>
<p>Tras una serie de dudas, problemas y correos con el soporte, ten√≠a todo listo para usar <em>deepops</em>. Ten√≠a  la instalaci√≥n del sistema operativo que recomendaba el fabricante y la configuraci√≥n que general que hab√≠a recomendado el socio distribuidor. Hice algunos cambios de rigor, y otras man√≠as que se le crean a uno cuando lleva un tiempo en esto de los servidores y sus problemas. Me lanc√© al ataque.</p>
<h3 id="al-ataque">Al ataque</h3>
<p>Configur√© las variables tal como se recomendaba, me le√≠ el resto por si las moscas, y desactiv√© un par de cosas que fuera no se mencionaban, pero que alg√∫n alma caritativa hab√≠a dejado en los comentarios por si te pasabas. Cierto es que no afectaban al funcionamiento, pero eran opcionales y no lo quer√≠a.</p>
<p>Me lanc√© a la instalaci√≥n, y tras ejecutarse las primeras tareas vino el primer error. Una variable que no exist√≠a o no ten√≠a valor. Todos sabemos como va esto, buscas informaci√≥n, te vas a la documentaci√≥n (que no dice nada de esa variable). Entonces aumentas el modo <em>verboso</em> al m√°ximo <em>-vvv</em> y te dispones a buscar en que fichero falla. En algunas ocasiones esto no es suficiente, pero insistes y finalmente encuentras una pista y crees que has dado con el fichero en el que se define. En mi caso as√≠ lo encontramos, o eso cre√≠, no se mencionaba en ning√∫n otro sitio y parec√≠a que era efectivamente una ejecuci√≥n para dar valor a la variable y utilizarla, todo en el mismo fichero. Pasamos a buscar una soluci√≥n, y para no hacerlo largo el error no estaba en este fichero üòÖ .</p>
<p>La causa original del error es m√°s com√∫n de lo que parece, <strong>el idioma del sistema operativo</strong>. Cuando una comunidad crea una herramienta como esta, normalmente lo hace sobre instalaciones de sistemas en ingl√©s. Pero en ning√∫n sitio han puesto los <em>requisitos del sistema</em>, ni han mencionado que el idioma sea relevante. Leyendo entre los fichero, descubr√≠ una serie de scripts que obtienen informaci√≥n de comandos como <em>lscpu</em>, <em>free -m</em>, etc, utilizando <em>grep</em>. El caso es que estos comandos muestran salidas traducidas cuando tu sistema operativo no est√° en ingl√©s. El resultado es que <em>grep</em> no devuelve nada, no se obtiene la informaci√≥n y por tanto las variables no tienen valor, provocando luego un error en tiempo de ejecuci√≥n.</p>
<h3 id="ya-est√°-todo-instalado-pero-no-en-funcionamiento">Ya est√° todo instalado, pero no en funcionamiento</h3>
<p>Una vez corriges tu problema, que gracias al c√≥digo abierto puedes tocar y arreglar por ti mismo, piensas ‚Äúo que bien todo funciona y es muy f√°cil de usar‚Äù, pero no. Siempre siempre siempre, que se despliega un entorno hay que hacer pruebas. Las herramientas, como <em>deepops</em> suelen tener algunas pruebas  autom√°ticas, que lanzamos y nos devuelven resultados, gr√°ficos, etc. Pero confiarte es un error, porque nunca son suficientes. La comunidad no ha pensado en todos los casos, y menos si han a√±adido versiones nuevas que a su vez usan versiones nuevas de otros programas.</p>
<p>En este caso estoy usando <em>slurm</em>, para lanzar tareas, pero por debajo tambi√©n est√° <em>docker</em>, etc. Menos de 5 minutos despu√©s de terminar el despliegue y las pruebas autom√°ticas, se  le dej√≥ a los usuarios <em>beta</em> probar un uso cotidiano, y inmediatamente descubrieron el primer bug en el que yo no hubiera pensado.</p>
<p>En casos como este siempre viene bien mirar las <em>issues</em> del repositorio, y efectivamente ah√≠ estaba <a href="https://github.com/NVIDIA/deepops/issues/783">issues</a>. El dns interno de <em>docker</em> se va de fiesta, y luego tus contenedores no tienen conexi√≥n con ning√∫n sitio, pero tampoco puedes construir im√°genes en local y a√±adir nuevo software.  Pongo el error, en el que de paso el usuario ha dado una ‚Äúsoluci√≥n‚Äù temporal, por as√≠ decirlo, a la vez que lo notifica, y lo pongo porque es un error que puede ocurrir con muchas otras herramientas que usan <em>docker</em> por debajo. Vale la pena recordar que cuando desplegamos cualquier entorno de contenedores hay que probar la conectividad y la resoluci√≥n de nombres, tanto en la red interna como con el exterior.</p>
<h2 id="en-resumen">En resumen</h2>
<p>Creo que si hay algo que aprender de esto es que cuando recurrimos a herramientas mantenidas de manera desinteresadas, vamos a tener que poner de nuestra parte un poquito m√°s. En cambio obtendremos tambi√©n las facilidades y el conocimiento para resolvernos nuestros propios problemas sobre la marcha o incluso ayudar a otros.</p>
<p>Cuando hay poca documentaci√≥n, toca trabajar un poco m√°s, y hacer m√°s ensayos, pero tal vez descubramos algo √∫til que probablemente tampoco estar√≠a en la documentaci√≥n.</p>
<p>Finalmente, hay que recordar que las pruebas autom√°ticas est√°n muy bien, pero como cada entorno es diferente y complejo. Siempre tendremos que probar por nuestra parte, adem√°s si cuentas con usuarios que com√∫nmente utilicen entornos similares hay que aprovecharlos y dejarlos probar. Nada como la experiencia para saber si algo no est√° funcionando como deber√≠a.</p>
<p>Saludos
<a href="https://github.com/DarFig">DarFig</a></p>
                        
                        </div>
                        <br>
                    </div>
                    
                </div>
                <div class=" card-footer is-right">
                    <div class="card-header-title is-centered">
                        January 17 - 2021
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

        </div>
        
    <div class="alpie"></div>   
    </body><footer  class="negro pie">
    <div class="container">
        <div>
            <br>
            <p align="center"  class="textoVerde LettCab text-muted">
                ¬© by darfig <a href="https://github.com/DarFig">https://github.com/DarFig</a>
            </p>
        </div>
    </div>

</footer>



</html>
